<div class="col-md-6 col-lg-4 mb-3">
  <div class="card task-card <%= todo.completed ? 'task-completed' : '' %>">
    <!-- Priority indicator -->
    <div class="priority-indicator priority-<%= todo.priority %>"></div>
    
    <div class="card-body">
      <div class="d-flex align-items-start">
        <form action="/toggle/<%= todo.id %>" method="post" class="me-2">
          <input 
            type="checkbox" 
            class="form-check-input task-checkbox" 
            <%= todo.completed ? 'checked' : '' %>
            onchange="this.form.submit()"
          />
        </form>
        <div class="flex-grow-1">
          <!-- Display mode -->
          <div class="task-display-<%= todo.id %>">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <p class="card-text mb-0"><%= todo.content %></p>
              <span class="badge priority-badge bg-<%= todo.priority === 'high' ? 'danger' : todo.priority === 'medium' ? 'warning' : 'success' %>">
                <%= todo.priority === 'high' ? '游댮 High' : todo.priority === 'medium' ? '游리 Medium' : '游릭 Low' %>
              </span>
            </div>
            <small class="text-muted">
              <i class="bi bi-calendar3"></i> 
              Added: <%= new Date(todo.created_at || Date.now()).toLocaleDateString() %>
            </small>
            <% if (todo.due_date) { %>
              <br><small class="due-date-indicator">
                <i class="bi bi-clock"></i>
                <% 
                  const today = new Date();
                  const dueDate = new Date(todo.due_date);
                  const diffTime = dueDate.getTime() - today.getTime();
                  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                  let dueDateClass = '';
                  let dueDateText = '';
                  
                  if (diffDays < 0) {
                    dueDateClass = 'due-overdue';
                    dueDateText = `Overdue by ${Math.abs(diffDays)} day(s)`;
                  } else if (diffDays === 0) {
                    dueDateClass = 'due-today';
                    dueDateText = 'Due today';
                  } else if (diffDays === 1) {
                    dueDateClass = 'due-upcoming';
                    dueDateText = 'Due tomorrow';
                  } else if (diffDays <= 7) {
                    dueDateClass = 'due-upcoming';
                    dueDateText = `Due in ${diffDays} days`;
                  } else {
                    dueDateText = `Due ${dueDate.toLocaleDateString()}`;
                  }
                %>
                <span class="<%= dueDateClass %>"><%= dueDateText %></span>
              </small>
            <% } %>
            <% if (todo.completed) { %>
              <br><small class="text-success">
                <i class="bi bi-check-circle"></i> Completed
              </small>
            <% } %>
          </div>
          
          <!-- Edit mode -->
          <div class="task-edit-<%= todo.id %> edit-form">
            <form action="/edit/<%= todo.id %>" method="post">
              <div class="mb-2">
                <input 
                  type="text" 
                  name="content" 
                  class="form-control form-control-sm" 
                  value="<%= todo.content %>" 
                  required
                />
              </div>
              <div class="row g-2 mb-2">
                <div class="col-6">
                  <select name="priority" class="form-select form-select-sm">
                    <option value="low" <%= todo.priority === 'low' ? 'selected' : '' %>>游릭 Low</option>
                    <option value="medium" <%= todo.priority === 'medium' ? 'selected' : '' %>>游리 Medium</option>
                    <option value="high" <%= todo.priority === 'high' ? 'selected' : '' %>>游댮 High</option>
                  </select>
                </div>
                <div class="col-6">
                  <input 
                    type="date" 
                    name="due_date" 
                    class="form-control form-control-sm"
                    value="<%= todo.due_date ? new Date(todo.due_date).toISOString().split('T')[0] : '' %>"
                    min="<%= new Date().toISOString().split('T')[0] %>"
                  />
                </div>
              </div>
              <div class="d-flex gap-1">
                <button type="submit" class="btn btn-success btn-sm">
                  <i class="bi bi-check"></i> Save
                </button>
                <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit(<%= todo.id %>)">
                  <i class="bi bi-x"></i> Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
        
        <!-- Action buttons -->
        <div class="task-actions ms-2">
          <div class="d-flex flex-column gap-1">
            <button class="btn btn-outline-primary btn-sm" onclick="editTask(<%= todo.id %>)" title="Edit task">
              <i class="bi bi-pencil"></i>
            </button>
            <form action="/delete/<%= todo.id %>" method="post" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this task?')">
              <button type="submit" class="btn btn-outline-danger btn-sm" title="Delete task">
                <i class="bi bi-trash"></i>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
